# Анализ медицинских страховых расходов

## Описание проекта

Этот проект направлен на анализ факторов, влияющих на стоимость медицинской страховки. Он включает предобработку данных, однофакторный и корреляционный анализ, а также создание и оценку моделей машинного обучения для предсказания медицинских расходов.

## Содержание

1. [Описание данных](#описание-данных)
2. [Архитектура проекта](#архитектура-проекта)
3. [Предобработка данных](#предобработка-данных)
4. [Анализ данных](#анализ-данных)
   - [Гистограммы числовых признаков](#гистограммы-числовых-признаков)
   - [Однофакторный анализ](#однофакторный-анализ)
   - [Корреляционный анализ](#корреляционный-анализ)
5. [Моделирование](#моделирование)
   - [Построение и оценка моделей](#построение-и-оценка-моделей)
   - [Гиперпараметрическая настройка](#гиперпараметрическая-настройка)
   - [Полная модель](#полная-модель)
6. [Интерпретация модели](#интерпретация-модели)
7. [API](#api)
   - [/predict](#predict)
8. [Установка и запуск](#установка-и-запуск)
   - [Зависимости](#зависимости)

## Описание данных

Датасет содержит информацию о медицинских расходах для различных лиц с следующими атрибутами:

- `age`: Возраст основного выгодоприобретателя
- `sex`: Пол страхового агента (женщина, мужчина)
- `bmi`: Индекс массы тела (кг/м²)
- `children`: Количество детей, охваченных медицинским страхованием
- `smoker`: Курение (да/нет)
- `region`: Регион проживания бенефициара в США (северо-восток, юго-восток, юго-запад, северо-запад)
- `charges`: Индивидуальные медицинские расходы, выставленные медицинским страхованием

## Архитектура проекта

Проект по анализу медицинских страховых расходов состоит из следующих основных компонентов:

### 1. Загрузка и предобработка данных
- **Описание:** На этом этапе происходит загрузка исходных данных из CSV-файла, очистка данных от дубликатов и пропущенных значений, а также сохранение предобработанных данных для последующего анализа.
- **Технологии:** Pandas для обработки данных.

### 2. Анализ данных
- **Описание:** Включает выполнение однофакторного анализа для изучения распределений и зависимостей между признаками, а также корреляционного анализа для выявления взаимосвязей между числовыми и категориальными признаками.
- **Технологии:** Matplotlib и Seaborn для визуализации, Scipy для статистического анализа.

### 3. Моделирование
- **Описание:** Построение и оценка моделей машинного обучения для предсказания медицинских расходов. Включает этапы обучения моделей, гиперпараметрической настройки и использования различных методов машинного обучения (Наивный Байес, K-ближайших соседей, Логистическая регрессия).
- **Технологии:** Scikit-learn для построения моделей, GridSearchCV для настройки гиперпараметров.

### 4. Интерпретация модели
- **Описание:** Создание интерактивной панели с помощью ExplainerDashboard для визуализации результатов и интерпретации модели. Это позволяет пользователю исследовать, как различные факторы влияют на предсказания модели.
- **Технологии:** ExplainerDashboard для визуализации и интерпретации.

### 5. API
- **Описание:** Реализация REST API для предсказания медицинских расходов на основе входных данных. API предоставляет доступ к модели через HTTP-запросы.
- **Основные эндпоинты:**
  - **`/predict`** - Предсказание класса расходов на медицинскую страховку.
- **Технологии:** Flask для разработки API.

### 6. Запуск и деплой
- **Описание:** Проект может быть запущен локально для выполнения предсказаний и анализа. Включает установку зависимостей и запуск сервера для API и панели интерпретации.
- **Технологии:** Python для выполнения скриптов, Pip для управления зависимостями.

### 7. Сохранение и загрузка моделей
- **Описание:** Обученные модели и предобработанные данные сохраняются в файлы для последующего использования, что позволяет избежать повторного обучения при каждом запуске.
- **Технологии:** Joblib для сохранения моделей.


## Предобработка данных

1. Загрузка данных из CSV-файла.
2. Удаление дубликатов и пропущенных значений.
3. Сохранение предобработанных данных в новый CSV-файл.

## Анализ данных

### Гистограммы числовых признаков

Отображение распределений для возраста, ИМТ и количества детей.

### Однофакторный анализ

- Распределение количества детей
- Зависимость расходов от количества детей
- Анализ ИМТ и его влияние на расходы
- Анализ возраста и его влияние на расходы
- Анализ курения и его влияние на расходы
- Анализ пола и региона и их влияние на расходы

### Корреляционный анализ

- Корреляция Пирсона и Спирмена между числовыми признаками
- V-мера Крамера для категориальных признаков
- ANOVA тест для проверки зависимости между категориальными и числовыми признаками

## Моделирование

### Построение и оценка моделей

- **Наивный Баес**:
  - Тренировка и оценка модели.
- **K-ближайших соседей (KNN)**:
  - Тренировка и оценка модели.
- **Логистическая регрессия**:
  - Тренировка и оценка модели.

### Гиперпараметрическая настройка

Использование `GridSearchCV` для поиска оптимальных гиперпараметров для каждой модели.

### Полная модель

Объединение категориальных и числовых признаков в одну модель с использованием `Pipeline` и `ColumnTransformer`.

## Интерпретация модели

Использование `ExplainerDashboard` для создания интерактивной панели, позволяющей визуализировать влияние различных факторов на предсказания модели.

## API

### /predict

**Метод**: POST

**Описание**: Предсказание класса расходов на медицинскую страховку.

**Запрос**:

```json
{
  "age": 29,
  "children": 0,
  "bmi": 26.1,
  "sex": "male",
  "smoker": "yes",
  "region": "southwest"
}
```

**Ответ**:

```json
{
  "prediction": "High"
}
```
## Установка и запуск

1. Клонируйте репозиторий:
   
  ```bash
   git clone https://github.com/IlyaKonoval/Medical-Cost-Personal.git
  ```
2. Перейдите в каталог проекта:
   
  ```bash
  cd Medical-Cost-Personal
  ```
3. Установите зависимости:

  ```bash
   pip install -r requirements.txt
  ```
4. Запустите API и панель интерпретации:
   
  ```bash
   python app.py
  ```
5. Откройте браузер и перейдите по адресу http://localhost:9051 для доступа к API и http://localhost:9050 для панели интерпретации.
## Зависимости:

### Проект использует следующие библиотеки:
+ `numpy==2.0.1`
+ `pandas==2.2.2`
+ `matplotlib==3.9.2`
+ `seaborn==0.13.2`
+ `scikit-learn==1.5.1`
+ `scipy==1.14.1`
+ `joblib==1.4.2`
+ `dill==0.3.8`
+ `explainerdashboard==0.4.7`
+ `Flask==3.0.3`
